#!/bin/bash

get_ip_address_with_subnet_mask(){
    output=$(ip -4 a)
    brd=$(echo "$output" | grep inet | grep -v '127.0.0.' | tail -n 1 )
    subnetAddress=$(echo "$brd" | awk '{print $2}')
    #echo $subnetAddress >> ./offensive/pentest/network-information.txt 
    echo $subnetAddress
}

get_ipv4_address(){
    ip=$(echo $1 | cut -d'/' -f1)
    #echo $ip >> ./offensive/pentest/network-information.txt
    echo $ip
}

get_network_address(){
    mask=$(echo $1 | cut -d'/' -f2 | cut -d ' ' -f1)
    a=$(echo $2| cut -d'.' -f4 --complement)
    echo $a.0/$mask #>> ./offensive/pentest/network-information.txt
}

main() {    
    ipAddressWithSubnetMask=$(get_ip_address_with_subnet_mask)

    ipv4Address=$(get_ipv4_address $ipAddressWithSubnetMask)

    networkAddress=$(get_network_address $ipAddressWithSubnetMask $ipv4Address)

    echo "$ipAddressWithSubnetMask" > ./offensive/pentest/network-information.txt
    echo "$ipv4Address" >> ./offensive/pentest/network-information.txt
    echo "$networkAddress" >> ./offensive/pentest/network-information.txt
}

main